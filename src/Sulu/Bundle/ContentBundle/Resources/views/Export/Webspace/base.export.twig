{% block content %}
    {% set counter = 0 %}
{{- block('pages') -}}
{% endblock content %}

{% if false %} {# avoid output of block directly #}
    {# Iterate over the pages #}
    {%- block pages -%}
        {%- for document in documents -%}
            {% spaceless %}
            {% set metaData = metaDataList[loop.index0] %}
            {% set extensions = extensionDataList[loop.index0] %}
            {% set properties = metaData.properties %}
            {% endspaceless %}{{ block('page') }}
        {%- endfor -%}
    {%- endblock pages -%}

    {# Output page #}
    {%- block page -%}
        {{ block('properties') }}
    {%- endblock page -%}

    {# Iterate over properties and extensionProperties #}
    {%- block properties -%}
        {%- for key, property in properties -%}
            {{- block('property') -}}
        {%- endfor -%}
        {%- for extensionKey, extension in extensions -%}
            {%- for extensionProperty in extension -%}
                {{- block('extensionProperty') -}}
            {%- endfor -%}
        {%- endfor -%}
    {%- endblock properties -%}

    {# Analyze Property and call right block #}
    {%- block extensionProperty -%}
        {% set propertyName = extensionProperty.name %}
        {% set propertyValue = extensionProperty.value %}
        {% set propertyOptions = extensionProperty.options %}
        {% set propertyType = extensionKey ~ '-extension' %}
        {{- block('extensionModel') -}}
    {%- endblock extensionProperty -%}

    {# Analyze Property and call right block #}
    {%- block property -%}
        {%- if property.type in ['block'] -%}
            {{- block('nested') -}}
        {%- else -%}
            {{- block('flat') -}}
        {%- endif -%}
    {%- endblock property -%}

    {# Block Content Type #}
    {%- block nested -%}
        {% set blockData = sulu_content_type_export(property.type, document.structure.getProperty(property.name).value) %}
        {% for item in blockData %}
            {% set prefix = key ~ '#' ~ loop.index0 ~ '-' %}

            {% set propertyName = prefix ~ 'type' %}
            {% set propertyValue = item.type %}
            {% set propertyType = 'block' %}
            {{- block('model') -}}

            {% for blockProperty in property.getComponentByName(item.type).children %}
                {% set propertyName = prefix ~ blockProperty.name %}
                {% set propertyValue = item[blockProperty.name] %}
                {% set propertyType = blockProperty.type %}
                {{- block('model') -}}
            {% endfor %}
        {% endfor %}
    {%- endblock nested -%}

    {# None Nested Content Types #}
    {%- block flat -%}
        {% set propertyName = property.name %}
        {% set propertyType = property.type %}
        {% set propertyValue = document.structure.getProperty(property.name).value %}
        {{- block('model') -}}
    {%- endblock flat -%}

    {# Create Model for Render #}
    {%- block model -%}
        {%- if sulu_content_type_has_export(propertyType, format) -%}
            {{- block('view') -}}
        {%- endif -%}
    {%- endblock model -%}

    {# Create Extension Model for Render #}
    {%- block extensionModel -%}
        {{- block('view') -}}
    {%- endblock extensionModel -%}

    {# Trans Unit Output #}
    {%- block view -%}{%- endblock view -%}
{% endif %}
